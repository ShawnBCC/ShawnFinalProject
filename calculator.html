<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Calculator - Miniature Warrior</title>

  <!-- Main site CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- jQuery + jsPDF -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }

    .calc-container {
      max-width: 900px;
      margin: 30px auto;
      padding: 25px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,.15);
    }

    header {
      background: #040c1a;
      padding: 15px;
      color: #fff;
      text-align: center;
    }

    header img {
      width: 100px;
      display: block;
      margin: 0 auto 10px;
    }

    /* Header inside invoice card */
    .invoice-header {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #ccc;
    }

    .invoice-header-left {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .invoice-header-left img {
      width: 60px;
      height: 60px;
      background: #040c1a;
      padding: 6px;
      border-radius: 6px;
    }

    .invoice-company-details {
      font-size: 12px;
      line-height: 1.4;
    }

    .invoice-meta input {
      width: 140px;
      padding: 5px;
      font-size: 12px;
    }

    h4 { margin: 15px 0 5px; }

    textarea {
      width: 100%;
      min-height: 60px;
      padding: 6px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }

    th {
      background: #040c1a;
      color: #fff;
      padding: 8px;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #e3e3e3;
      text-align: center;
    }

    td:first-child { text-align: left; }

    .qty {
      width: 55px;
      padding: 4px;
      text-align: center;
      font-size: 13px;
    }

    .unit-price { font-weight: bold; }

    .summary {
      text-align: right;
      margin-top: 20px;
      line-height: 1.8;
      font-size: 15px;
    }

    .summary input {
      width: 65px;
      padding: 3px;
      text-align: center;
    }

    button {
      background: #1a2a4d;
      color: #ffcc00;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover { background: #2b3d66; }
  </style>
</head>

<body>

<header>
  <img src="images/my-logo.jpg" alt="Logo">
  <h1>Miniature Warrior</h1>

  <!-- ========= ADDED NAVIGATION ========= -->
  <button class="menu-toggle">â˜°</button>

  <nav class="main-nav">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="gallery.html">Gallery</a></li>

      <li class="has-submenu">
        <a href="#">Collections</a>
        <ul class="submenu">
          <li><a href="samurai.html">Samurai</a></li>
          <li><a href="knights.html">Knights</a></li>
          <li><a href="vikings.html">Vikings</a></li>
        </ul>
      </li>

      <li><a href="mortgage.html">Mortgage Calculator</a></li>
      <li><a href="milespergallon.html">MPG Calculator</a></li>
      <li><a href="calculator.html" class="active">Invoice Calculator</a></li>
      <li><a href="socialnews.html">Social News</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
  <!-- ========= END NAVIGATION ========= -->

</header>

<div class="calc-container">

  <h2 style="text-align:center;">Invoice Calculator</h2>

  <div class="invoice-header">

    <div class="invoice-header-left">
      <img src="images/my-logo.jpg" alt="Logo">

      <div>
        <h3 style="margin:0 0 3px;">Miniature Warrior</h3>
        <div class="invoice-company-details">
          123 Kingsbridge Plaza, Suite 4B<br>
          Bronx, NY 10463<br>
          Phone: (718) 555-9821<br>
          Email: info@miniaturewarrior.com
        </div>
      </div>
    </div>

    <div class="invoice-meta">
      Invoice #<br>
      <input id="invoice_number" readonly><br><br>
      Date<br>
      <input type="date" id="invoice_date">
    </div>
  </div>

  <h4>Bill To</h4>
  <textarea id="bill_to"></textarea>

  <h4>For</h4>
  <textarea id="bill_for"></textarea>

  <table>
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Unit Price</th><th>Amount</th></tr>
    </thead>
    <tbody id="item-rows">
      <tr><td>Takeda Shingen</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="95">$95</td><td>$<span class="line">0.00</span></td></tr>
      <tr><td>Naoe Kanetsugu</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="72">$72</td><td>$<span class="line">0.00</span></td></tr>
      <tr><td>Ishida Mitsunari</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="88">$88</td><td>$<span class="line">0.00</span></td></tr>
      <tr><td>Kuroda Yoshitaka</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="63">$63</td><td>$<span class="line">0.00</span></td></tr>
      <tr><td>Imagawa Yoshimoto</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="79">$79</td><td>$<span class="line">0.00</span></td></tr>
      <tr><td>Maeda Keiji</td><td><input class="qty" type="number" min="0"></td><td class="unit-price" data-price="54">$54</td><td>$<span class="line">0.00</span></td></tr>
    </tbody>
  </table>

  <div class="summary">
    Subtotal: $<span id="sub">0.00</span><br>
    Discount (%) <input id="disc" type="number" value="0"><br>
    Tax (%) <input id="tax" type="number" value="8.875"><br>
    <h3>Total: $<span id="total">0.00</span></h3>
  </div>

  <button id="pdf">Download PDF</button>
  <button id="email">Email Invoice</button>

</div>

<script>
/* ---------------------------
   AUTO INVOICE NUMBER
---------------------------- */
document.addEventListener("DOMContentLoaded", () => {
  let last = localStorage.getItem("mw_last_invoice");
  last = last ? parseInt(last) + 1 : 1;
  localStorage.setItem("mw_last_invoice", last);
  document.getElementById("invoice_number").value = String(last).padStart(6, "0");
  updateTotals();
});

/* ---------------------------
   CALCULATIONS
---------------------------- */
function updateTotals() {
  let subtotal = 0;

  $("#item-rows tr").each(function () {
    let qty = parseFloat($(this).find(".qty").val()) || 0;
    let price = parseFloat($(this).find(".unit-price").data("price"));
    let amount = qty * price;
    $(this).find(".line").text(amount.toFixed(2));
    subtotal += amount;
  });

  $("#sub").text(subtotal.toFixed(2));

  let discount = parseFloat($("#disc").val()) || 0;
  let tax = parseFloat($("#tax").val()) || 0;

  let afterDiscount = subtotal - (subtotal * discount / 100);
  let total = afterDiscount + (afterDiscount * tax / 100);

  $("#total").text(total.toFixed(2));
}

$(document).on("input", ".qty, #disc, #tax", updateTotals);


/* ---------------------------
   PDF GENERATOR WITH LOGO
---------------------------- */
$("#pdf").click(function () {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "pt", "letter");

  const darkBlue = "#040c1a";
  const lightGray = "#f1f1f1";

  let logo = new Image();
  logo.src = "images/my-logo.jpg";

  logo.onload = function () {

    // Header banner
    doc.setFillColor(darkBlue);
    doc.rect(0, 0, 612, 90, "F");

    // Logo
    doc.addImage(logo, "JPEG", 25, 18, 60, 60);

    // Header text
    doc.setTextColor("#fff");
    doc.setFontSize(22);
    doc.text("Miniature Warrior", 100, 50);

    doc.setFontSize(10);
    doc.text("123 Kingsbridge Plaza, Suite 4B | Bronx, NY 10463", 100, 68);
    doc.text("Phone: (718) 555-9821   Email: info@miniaturewarrior.com", 100, 82);

    // Invoice title
    doc.setTextColor("#000");
    doc.setFontSize(18);
    doc.text("Invoice #" + $("#invoice_number").val(), 40, 130);

    doc.setFontSize(12);
    doc.text("Date: " + ($("#invoice_date").val() || "________"), 40, 148);

    // BILL TO & FOR
    doc.setFontSize(14);
    doc.text("Bill To", 40, 185);
    doc.text("For", 330, 185);

    doc.setFontSize(11);

    $("#bill_to").val().split("\n").forEach((line, i) => {
      doc.text(line, 40, 205 + i * 14);
    });

    $("#bill_for").val().split("\n").forEach((line, i) => {
      doc.text(line, 330, 205 + i * 14);
    });

    // Table header
    let startY = 270;
    doc.setFillColor(darkBlue);
    doc.setTextColor("#fff");
    doc.rect(40, startY, 532, 25, "F");

    doc.setFontSize(12);
    doc.text("Item Description", 55, startY + 17);
    doc.text("Qty", 300, startY + 17);
    doc.text("Unit Price", 370, startY + 17);
    doc.text("Amount", 470, startY + 17);

    // Table rows
    doc.setTextColor("#000");
    let y = startY + 43;
    doc.setFontSize(11);

    $("#item-rows tr").each(function () {
      const item = $(this).find("td:eq(0)").text();
      const qty = $(this).find(".qty").val() || "0";
      const price = $(this).find(".unit-price").text();
      const amount = $(this).find(".line").text();

      doc.text(item, 55, y);
      doc.text(String(qty), 305, y);
      doc.text(price, 380, y);
      doc.text("$" + amount, 470, y);

      y += 18;
    });

    // Totals
    let totalsY = y + 20;

    doc.setFontSize(12);
    doc.text("Subtotal:", 380, totalsY);
    doc.text("$" + $("#sub").text(), 500, totalsY);

    doc.text("Discount:", 380, totalsY + 18);
    doc.text($("#disc").val() + "%", 500, totalsY + 18);

    doc.text("Tax:", 380, totalsY + 36);
    doc.text($("#tax").val() + "%", 500, totalsY + 36);

    // Total box
    doc.setFillColor(lightGray);
    doc.rect(350, totalsY + 50, 230, 40, "F");

    doc.setFontSize(14);
    doc.text("Total Cost:", 360, totalsY + 78);
    doc.text("$" + $("#total").text(), 500, totalsY + 78);

    // Footer
    doc.setFontSize(10);
    doc.text("If you have any questions, contact info@miniaturewarrior.com.", 40, 720);
    doc.text("Thank you for your business!", 40, 738);

    // Save
    doc.save("invoice_" + $("#invoice_number").val() + ".pdf");
  };
});


/* ---------------------------
   EMAIL
---------------------------- */
$("#email").click(function () {
  const subject = "Invoice " + $("#invoice_number").val();
  const body = encodeURIComponent(
    "Invoice #: " + $("#invoice_number").val() +
    "\nDate: " + ($("#invoice_date").val() || "") +
    "\n\nTotal: $" + $("#total").text()
  );
  window.location.href = "mailto:?subject=" + encodeURIComponent(subject) + "&body=" + body;
});
</script>

</body>
</html>
